var Typo;!function(){"use strict";Typo=function(a,b,c,d){function e(a,b){var c=n._readFile(a,null,d.asyncLoad);d.asyncLoad?c.then(function(a){b(a)}):b(c)}function f(a){b=a,c&&h()}function g(a){c=a,b&&h()}function h(){for(n.rules=n._parseAFF(b),n.compoundRuleCodes={},j=0,l=n.compoundRules.length;j<l;j++){var a=n.compoundRules[j];for(k=0,m=a.length;k<m;k++)n.compoundRuleCodes[a[k]]=[]}"ONLYINCOMPOUND"in n.flags&&(n.compoundRuleCodes[n.flags.ONLYINCOMPOUND]=[]),n.dictionaryTable=n._parseDIC(c);for(j in n.compoundRuleCodes)0===n.compoundRuleCodes[j].length&&delete n.compoundRuleCodes[j];for(j=0,l=n.compoundRules.length;j<l;j++){var e=n.compoundRules[j],f="";for(k=0,m=e.length;k<m;k++){var g=e[k];g in n.compoundRuleCodes?f+="("+n.compoundRuleCodes[g].join("|")+")":f+=g}n.compoundRules[j]=new RegExp(f,"i")}n.loaded=!0,d.asyncLoad&&d.loadedCallback&&d.loadedCallback(n)}d=d||{},this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=d.flags||{},this.memoized={},this.loaded=!1;var i,j,k,l,m,n=this;return a&&(n.dictionary=a,b&&c?h():"undefined"!=typeof window&&"chrome"in window&&"extension"in window.chrome&&"getURL"in window.chrome.extension?(i=d.dictionaryPath?d.dictionaryPath:"typo/dictionaries",b||e(chrome.extension.getURL(i+"/"+a+"/"+a+".aff"),f),c||e(chrome.extension.getURL(i+"/"+a+"/"+a+".dic"),g)):(i=d.dictionaryPath?d.dictionaryPath:"undefined"!=typeof __dirname?__dirname+"/dictionaries":"./dictionaries",b||e(i+"/"+a+"/"+a+".aff",f),c||e(i+"/"+a+"/"+a+".dic",g))),this},Typo.prototype={load:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);return this},_readFile:function(a,b,c){if(b=b||"utf8","undefined"!=typeof XMLHttpRequest){var d,e=new XMLHttpRequest;return e.open("GET",a,c),c&&(d=new Promise(function(a,b){e.onload=function(){200===e.status?a(e.responseText):b(e.statusText)},e.onerror=function(){b(e.statusText)}})),e.overrideMimeType&&e.overrideMimeType("text/plain; charset="+b),e.send(null),c?d:e.responseText}if("undefined"!=typeof require){var f=require("fs");try{if(f.existsSync(a)){var g=f.statSync(a),h=f.openSync(a,"r"),i=new Buffer(g.size);return f.readSync(h,i,0,i.length,null),i.toString(b,0,i.length)}console.log("Path "+a+" does not exist.")}catch(a){return console.log(a),""}}},_parseAFF:function(a){var b,c,d,e,f,g,h,i,j={};a=this._removeAffixComments(a);var k=a.split("\n");for(f=0,h=k.length;f<h;f++){b=k[f];var l=b.split(/\s+/),m=l[0];if("PFX"==m||"SFX"==m){var n=l[1],o=l[2];d=parseInt(l[3],10);var p=[];for(g=f+1,i=f+1+d;g<i;g++){c=k[g],e=c.split(/\s+/);var q=e[2],r=e[3].split("/"),s=r[0];"0"===s&&(s="");var t=this.parseRuleCodes(r[1]),u=e[4],v={};v.add=s,t.length>0&&(v.continuationClasses=t),"."!==u&&(v.match="SFX"===m?new RegExp(u+"$"):new RegExp("^"+u)),"0"!=q&&(v.remove="SFX"===m?new RegExp(q+"$"):q),p.push(v)}j[n]={type:m,combineable:"Y"==o,entries:p},f+=d}else if("COMPOUNDRULE"===m){for(d=parseInt(l[1],10),g=f+1,i=f+1+d;g<i;g++)b=k[g],e=b.split(/\s+/),this.compoundRules.push(e[1]);f+=d}else"REP"===m?(e=b.split(/\s+/),3===e.length&&this.replacementTable.push([e[1],e[2]])):this.flags[m]=l[1]}return j},_removeAffixComments:function(a){return a=a.replace(/^\s*#.*$/gm,""),a=a.replace(/^\s\s*/m,"").replace(/\s\s*$/m,""),a=a.replace(/\n{2,}/g,"\n"),a=a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},_parseDIC:function(a){function b(a,b){d.hasOwnProperty(a)||(d[a]=null),b.length>0&&(null===d[a]&&(d[a]=[]),d[a].push(b))}a=this._removeDicComments(a);for(var c=a.split("\n"),d={},e=1,f=c.length;e<f;e++){var g=c[e],h=g.split("/",2),i=h[0];if(h.length>1){var j=this.parseRuleCodes(h[1]);"NEEDAFFIX"in this.flags&&-1!=j.indexOf(this.flags.NEEDAFFIX)||b(i,j);for(var k=0,l=j.length;k<l;k++){var m=j[k],n=this.rules[m];if(n)for(var o=this._applyRule(i,n),p=0,q=o.length;p<q;p++){var r=o[p];if(b(r,[]),n.combineable)for(var s=k+1;s<l;s++){var t=j[s],u=this.rules[t];if(u&&u.combineable&&n.type!=u.type)for(var v=this._applyRule(r,u),w=0,x=v.length;w<x;w++){var y=v[w];b(y,[])}}}m in this.compoundRuleCodes&&this.compoundRuleCodes[m].push(i)}}else b(i.trim(),[])}return d},_removeDicComments:function(a){return a=a.replace(/^\t.*$/gm,"")},parseRuleCodes:function(a){if(!a)return[];if(!("FLAG"in this.flags))return a.split("");if("long"===this.flags.FLAG){for(var b=[],c=0,d=a.length;c<d;c+=2)b.push(a.substr(c,2));return b}return"num"===this.flags.FLAG?a.split(","):void 0},_applyRule:function(a,b){for(var c=b.entries,d=[],e=0,f=c.length;e<f;e++){var g=c[e];if(!g.match||a.match(g.match)){var h=a;if(g.remove&&(h=h.replace(g.remove,"")),"SFX"===b.type?h+=g.add:h=g.add+h,d.push(h),"continuationClasses"in g)for(var i=0,j=g.continuationClasses.length;i<j;i++){var k=this.rules[g.continuationClasses[i]];k&&(d=d.concat(this._applyRule(h,k)))}}}return d},check:function(a){if(!this.loaded)throw"Dictionary not loaded.";var b=a.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(b))return!0;if(b.toUpperCase()===b){var c=b[0]+b.substring(1).toLowerCase();if(this.hasFlag(c,"KEEPCASE"))return!1;if(this.checkExact(c))return!0}var d=b.toLowerCase();if(d!==b){if(this.hasFlag(d,"KEEPCASE"))return!1;if(this.checkExact(d))return!0}return!1},checkExact:function(a){if(!this.loaded)throw"Dictionary not loaded.";var b,c,d=this.dictionaryTable[a];if(void 0===d){if("COMPOUNDMIN"in this.flags&&a.length>=this.flags.COMPOUNDMIN)for(b=0,c=this.compoundRules.length;b<c;b++)if(a.match(this.compoundRules[b]))return!0}else{if(null===d)return!0;if("object"==typeof d)for(b=0,c=d.length;b<c;b++)if(!this.hasFlag(a,"ONLYINCOMPOUND",d[b]))return!0}return!1},hasFlag:function(a,b,c){if(!this.loaded)throw"Dictionary not loaded.";return!!(b in this.flags&&(void 0===c&&(c=Array.prototype.concat.apply([],this.dictionaryTable[a])),c&&-1!==c.indexOf(this.flags[b])))},alphabet:"",suggest:function(a,b){function c(a){var b,c,d,e,f,g,h=[];for(b=0,e=a.length;b<e;b++){var i=a[b];for(c=0,f=i.length+1;c<f;c++){var k=[i.substring(0,c),i.substring(c)];if(k[1]&&h.push(k[0]+k[1].substring(1)),k[1].length>1&&k[1][1]!==k[1][0]&&h.push(k[0]+k[1][1]+k[1][0]+k[1].substring(2)),k[1])for(d=0,g=j.alphabet.length;d<g;d++)j.alphabet[d]!=k[1].substring(0,1)&&h.push(k[0]+j.alphabet[d]+k[1].substring(1));if(k[1])for(d=0,g=j.alphabet.length;d<g;d++)h.push(k[0]+j.alphabet[d]+k[1])}}return h}function d(a){for(var b=[],c=0,d=a.length;c<d;c++)j.check(a[c])&&b.push(a[c]);return b}if(!this.loaded)throw"Dictionary not loaded.";if(b=b||5,this.memoized.hasOwnProperty(a)){var e=this.memoized[a].limit;if(b<=e||this.memoized[a].suggestions.length<e)return this.memoized[a].suggestions.slice(0,b)}if(this.check(a))return[];for(var f=0,g=this.replacementTable.length;f<g;f++){var h=this.replacementTable[f];if(-1!==a.indexOf(h[0])){var i=a.replace(h[0],h[1]);if(this.check(i))return[i]}}var j=this;return j.alphabet="abcdefghijklmnopqrstuvwxyz",this.memoized[a]={suggestions:function(a){function e(a,b){return a[1]<b[1]?-1:1}var f,g,h=c([a]),i=c(h),k=d(h.concat(i)),l={};for(f=0,g=k.length;f<g;f++)k[f]in l?l[k[f]]+=1:l[k[f]]=1;var m=[];for(f in l)l.hasOwnProperty(f)&&m.push([f,l[f]]);m.sort(e).reverse();var n=[],o="lowercase";for(a.toUpperCase()===a?o="uppercase":a.substr(0,1).toUpperCase()+a.substr(1).toLowerCase()===a&&(o="capitalized"),f=0,g=Math.min(b,m.length);f<g;f++)"uppercase"===o?m[f][0]=m[f][0].toUpperCase():"capitalized"===o&&(m[f][0]=m[f][0].substr(0,1).toUpperCase()+m[f][0].substr(1)),j.hasFlag(m[f][0],"NOSUGGEST")||n.push(m[f][0]);return n}(a),limit:b},this.memoized[a].suggestions}}}(),"undefined"!=typeof module&&(module.exports=Typo);